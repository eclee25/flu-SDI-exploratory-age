##############################################
###R template
###Author: Elizabeth Lee
###Date: 9/21/12	
###Function: clean and cast data to look at information by age group by year for the symptoms of interest. draw bar plots of information.
###Import data: Agegrp_ILI_Wk.csv (9/20/12: 4:16:36 PM EDT)
###Outputs: 

###Command Line: R
##############################################

### packages ###
library(reshape)
library(RColorBrewer)

### functions ###

### data structures ###

### import data ###
data<-read.csv('Agegrp_ILI_Wk.csv', colClasses='character')
colnames(data)<-c('AGEGROUP', 'WEEK', 'sum_ILI_m', 'sum_ANY_DIAG_VISIT_CT', 'ILI_prop')

### figure template ###
agecol<-brewer.pal(12,"Set3")
yrcol<-brewer.pal(11, "Spectral")
weeknum<-seq(1,496)
agelab<-c("<2 YEARS", "2-4 YEARS", "5-9 YEARS", "10-14 YEARS", "15-19 YEARS", "20-29 YEARS", "30-39 YEARS", "40-49 YEARS", "50-59 YEARS", "60-69 YEARS", "70-79 YEARS", ">80 YEARS")

### program ###
#rm TOTAL agegroup data
data2<-data[data$AGEGROUP!="TOTAL",]

#reshape data for barplot format
colnames(data2)<-c("AGEGROUP", "WEEK", "value", "sum_ANY_DIAG_VISIT_CT", "ILI_prop")
ILI<-data.frame(cast(data2, WEEK~AGEGROUP))
ILI2<-apply(ILI[,2:13],2,as.numeric)
rownames(ILI2)<-ILI[,1]

colnames(data2)<-c("AGEGROUP", "WEEK", "sum_ILI_m", "value", "ILI_prop")
Any<-data.frame(cast(data2, WEEK~AGEGROUP))
Any2<-apply(Any[,2:13],2,as.numeric)
rownames(Any2)<-ILI[,1]

colnames(data2)<-c("AGEGROUP", "WEEK", "sum_ILI_m", "sum_ANY_DIAG_VISIT_CT", "value")
Prop<-data.frame(cast(data2, WEEK~AGEGROUP))
Prop2<-apply(Prop[,2:13],2,as.numeric)
rownames(Prop2)<-ILI[,1]

#organize data for lineplots (x-axis = week)
ageorder<-c(5,4,9,1,2,3,6,7,8,10,11,12)
ILIbp<-ILI2[,ageorder]/100
Anybp<-Any2[,ageorder]/1000
Propbp<-Prop2[,ageorder]

#draw lineplot over weeks
postscript("/home/elizabeth/Documents/Georgetown/Bansal/SDI/graph_outputs/ILI_cts_wk.ps")
plot(weeknum,ILIbp[,3],type='n', ylab="ILI counts in 100s",xlab="week number (2000-12-31 to 2010-06-27)")
for (i in 1:length(agecol)){
	lines(weeknum,ILIbp[,i], col=agecol[i], cex=3)
}
legend(8,800,agelab, col=agecol, lwd=3)
dev.off()

postscript("/home/elizabeth/Documents/Georgetown/Bansal/SDI/graph_outputs/Any_cts_wk.ps")
plot(weeknum,Anybp[,9],type='n', ylab="Any Visit counts in 1000s",xlab="week number (2000-12-31 to 2010-06-27)")
for (i in 1:length(agecol)){
	lines(weeknum,Anybp[,i], col=agecol[i], cex=3)
}
legend(9,2600,agelab, col=agecol, lwd=3)
dev.off()

postscript("/home/elizabeth/Documents/Georgetown/Bansal/SDI/graph_outputs/Prop_cts_wk.ps")
plot(weeknum,Propbp[,4],type='n', ylab="ILI as a proportion of all visits", xlab="week number (2000-12-31 to 2010-06-27)")
for (i in 1:length(agecol)){
	lines(weeknum,Propbp[,i], col=agecol[i], cex=3)
}
legend(10, 0.1,agelab, col=agecol, lwd=3)
dev.off()


