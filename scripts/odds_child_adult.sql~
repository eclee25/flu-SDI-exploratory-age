/*----SQL TEMPLATE----
Author: Elizabeth Lee
Date: 3/29/13
Function: Grab data to draw charts for odds ratios of attack rates between children and adults across weeks for each season and across all seasons. Service facilities: all types, severe = acute & ER, mild = outpatient & office

Command Line: mysql -u elizabeth -pbansa11ab odds_child_adult.sql
Data: flu table: SDI
*/

-- grab data for children and adults across all seasons

-- grab data for children and adults across weeks for each season

SELECT season.SEASON_NUM, child.MARKER, sum(ILI_m)
from flu RIGHT JOIN season ON (flu.WEEK = season.WEEK) RIGHT JOIN child ON (child.AGEGROUP = flu.AGEGROUP)
WHERE flu.SERVICE_PLACE = "TOTAL" and flu.PATIENT_ZIP3 = "TOT"
GROUP BY season.SEASON_NUM, child.MARKER
;
----- run some checks on season 1 -----
SELECT sum(ILI_m)
from flu
WHERE (YEAR(WEEK) = 2000 OR (YEAR(WEEK) = 2001 and WEEK(WEEK)<40)) and flu.SERVICE_PLACE = "TOTAL" and flu.PATIENT_ZIP3 = "TOT" and (flu.AGEGROUP = '5-9 YEARS' OR flu.AGEGROUP = '10-14 YEARS' OR flu.AGEGROUP = '15-19 YEARS')
; -- check on child value

SELECT sum(ILI_m) from flu
WHERE (YEAR(WEEK) = 2000 OR (YEAR(WEEK) = 2001 and WEEK(WEEK)<40)) and flu.SERVICE_PLACE = "TOTAL" and flu.PATIENT_ZIP3 = "TOT" and (flu.AGEGROUP = '<2 YEARS' OR flu.AGEGROUP = '2-4 YEARS' OR flu.AGEGROUP = '60-69 YEARS' OR flu.AGEGROUP = '70-79 YEARS' OR flu.AGEGROUP = '80+ YEARS')
; -- check on adult value

SELECT sum(ILI_m) from flu
WHERE (YEAR(WEEK) = 2000 OR (YEAR(WEEK) = 2001 and WEEK(WEEK)<40)) and flu.SERVICE_PLACE = "TOTAL" and flu.PATIENT_ZIP3 = "TOT" and flu.AGEGROUP = "TOTAL"
; -- check on total season 1 value

